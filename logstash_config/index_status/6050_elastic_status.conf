# Author Bryant Treacle
# Date 2 May 18
# Modified by Steve Willson
# Last modified: 8/5/18
# Filter for input 0050_index_status.conf

filter {
    if "elastic-health" in [tags] {
        mutate {
            remove_field => ["headers", "host"]
        }
    }
}

filter {
    if "elasticsearch_status" in [tags] {
        mutate {
            rename => {
                "heap.percent" => "elasticsearch_heap_percent"
                "ram.percent" => "elasticsearch_ram_percent"
            }
        }
    }
}

filter {
    if "index_status" in [tags] {
        mutate {
            rename => {
                "memory.total" => "index_memory_size"
                "pri" => "primary_shards"
                "rep" => "replica_shards"
                "docs.count" => "docs_count"
                "docs.deleted" => "docs_deleted"
                "store.size" => "index_store_size"
            }
	}        
	ruby {
           code => "event.set('index_store_size_per_shard', event.get('index_store_size').to_i / event.get('primary_shards').to_i)"
        }
    }
}

# Filter for logstash_status

#filter {
#    if "logstash_status" in [tags] {
#    }
#}

filter {
    if "logstash_pipeline_status" in [tags] {
        ruby {
            code => "event.set('[events][dropped_events]', event.get('[events][in]').to_i - event.get('[events][out]').to_i)"
        }
    }
}

# Filter for syslog-ng stats

filter {
    if "syslog_ng_stats" in [tags] {
	mutate {
	    remove_field => ["syslog_ng_remove"]
	}
    }
}

# Filter for cluster_status
#filter {
#    if "cluster_status" in [tags] {
#    }
#}
