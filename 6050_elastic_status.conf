# Author Bryant Treacle
# Date 2 May 18
# Modified by Steve Willson
# Last modified: 8/5/18
# Filter for input 0050_index_status.conf

filter {
    if "elastic-health" in [tags] {
        mutate {
            remove_field => ["headers", "host"]
        }
    }
}

filter {
    if "node_status" in [tags] {
        mutate {
            rename => {
                "heap.percent" => "elasticsearch_heap_percent"
                "ram.percent" => "elsticsearch_ram_percent"
            }
        }
    }
}

filter {
    if "index_status" in [tags] {
        mutate {
            rename => {
                "memory.total" => "index_memory_size"
                "pri" => "primary_shards"
                "rep" => "replica_shards"
                "docs.count" => "docs_count"
                "docs.deleted" => "docs_deleted"
                "store.size" => "store_size_old"
            }
        }
    }
}

# DO NOTHING FOR THE TAG "logstash_status" at this time
#filter {
#    if "logstash_status" in [tags] {
#    }
#}

filter {
    if "logstash_pipeline_status" in [tags] {
        ruby {
            code => "event.set('[events][dropped_events]', event.get('[events][in]').to_i - event.get('[events][out]').to_i)"
        }
    }
}
# Filter for syslog-ng stats

filter {
    if "syslog_ng_stats" in [tags] {
       grok {
	match => { "message" => [ "sensor_name: %{DATA:sensor_name}", "syslog_ng_method: %{DATA:syslog_ng_method}", "syslog_ng_destination: %{DATA:syslog_ng_destination}", "syslog_ng_protocol: %{DATA:syslog_ng_protocol}", "syslog_ng_ip: %{DATA:syslog_ng_ip}", "syslog_ng_value: %{DATA:syslog_ng_value}", "syslog_ng_action: %{DATA:syslog_ng_action}", "syslog_ng_value: %{DATA:syslog_ng_value}" ] }
	}
    }
}
